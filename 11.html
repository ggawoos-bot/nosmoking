<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>하남시 금연구역 검색</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <!-- Kakao Map API Script -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b56d933cb3bcdf1b561bb27982f51566&libraries=services"></script>
    <style>
        .selected-card {
            background-color: #e2e8f0; /* bg-slate-200 */
            border-color: #3b82f6; /* border-blue-500 */
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4 font-sans">

    <!-- 애플리케이션 컨테이너 -->
    <div class="w-full max-w-4xl bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-6">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">하남시 금연구역 검색</h1>
        
        <!-- 검색 입력 필드 -->
        <div class="mb-6">
            <input type="text" id="search-input" placeholder="금연구역명 또는 주소로 검색..."
                   class="w-full px-4 py-2 text-lg border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
        </div>

        <!-- 검색 결과를 표시할 컨테이너 -->
        <div id="results-container" class="space-y-4 max-h-96 overflow-y-auto pr-2">
            <!-- 검색 결과가 여기에 동적으로 추가됩니다 -->
        </div>
    </div>
    
    <!-- 카카오 지도 컨테이너 -->
    <div id="map" class="w-full max-w-4xl h-96 bg-white rounded-xl shadow-lg border border-gray-200"></div>

    <!-- JavaScript 로직 -->
    <script type="text/javascript">
        // CSV 파일에서 직접 추출한 50개의 데이터
        const originalData = [
            {"금연구역명":"미래창의어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 덕풍북로31번길 22 등7필지 (풍산동)","관리기관명":"경기도 하남시청","위도":"37.54943632","경도":"127.1972667"},
            {"금연구역명":"미리별어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 감일순환로 135 감일포엠포레 508동 101호","관리기관명":"경기도 하남시청","위도":"37.5118058","경도":"127.1611988"},
            {"금연구역명":"미사다온어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변대로 135 미사강변19단지, 관리동어린이집","관리기관명":"경기도 하남시청","위도":"37.56209765","경도":"127.1858814"},
            {"금연구역명":"미사랑어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 아리수로 589 관리동 (망월동, 강변도시15단지)","관리기관명":"경기도 하남시청","위도":"37.56998054","경도":"127.1912158"},
            {"금연구역명":"미사별어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변대로 240 811동 103호","관리기관명":"경기도 하남시청","위도":"37.57104883","경도":"127.1861608"},
            {"금연구역명":"미사새싹어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 아리수로 499 505동 102호(미사강변도시 5단지)","관리기관명":"경기도 하남시청","위도":"37.56828268","경도":"127.1798198"},
            {"금연구역명":"미사아이자람어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변한강로 170 1109동 104호","관리기관명":"경기도 하남시청","위도":"37.57420252","경도":"127.192614"},
            {"금연구역명":"미사예랑어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 아리수로 499 강변미사 5단지, 507동 104호","관리기관명":"경기도 하남시청","위도":"37.56777128","경도":"127.1806939"},
            {"금연구역명":"미사자연어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변중앙로 100-2 미사강변 26단지 관리동","관리기관명":"경기도 하남시청","위도":"37.55663748","경도":"127.1935127"},
            {"금연구역명":"미사자이어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변대로 95-3 미사강변센트럴자이(21블럭)","관리기관명":"경기도 하남시청","위도":"37.55738359","경도":"127.1858898"},
            {"금연구역명":"미사키즈어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 아리수로 589 1503동 103호(망월동, 강변도시15단지)","관리기관명":"경기도 하남시청","위도":"37.56919708","경도":"127.1914908"},
            {"금연구역명":"미소어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 하남유니온로 70 103-102(에일린의 뜰)","관리기관명":"경기도 하남시청","위도":"37.54481372","경도":"127.2197221"},
            {"금연구역명":"민s몬테소리어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 대청로 79-1 대명강변타운아파트 단지내 관리동 (신장동)","관리기관명":"경기도 하남시청","위도":"37.54152853","경도":"127.221738"},
            {"금연구역명":"바롬새롬어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 하남대로777번길 56 (신장동)","관리기관명":"경기도 하남시청","위도":"37.53767536","경도":"127.2087127"},
            {"금연구역명":"바움어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변대로 240 8단지 810동 101호","관리기관명":"경기도 하남시청","위도":"37.57063403","경도":"127.1860946"},
            {"금연구역명":"밤비니어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 대청로116번길 59 416동 101호(창우동, 꿈동산신안아파트)","관리기관명":"경기도 하남시청","위도":"37.53755454","경도":"127.2260201"},
            {"금연구역명":"베베키즈어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 대청로 79 대명강변타운아파트 103동 101호","관리기관명":"경기도 하남시청","위도":"37.54042979","경도":"127.2221269"},
            {"금연구역명":"벼리어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변북로 130-2 관리동어린이집","관리기관명":"경기도 하남시청","위도":"37.57239173","경도":"127.1929725"},
            {"금연구역명":"벽산어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 신평로 36 106동 벽산어린이집","관리기관명":"경기도 하남시청","위도":"37.53613309","경도":"127.2047004"},
            {"금연구역명":"별바라기어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변대로 165 105동 104호(미사강변 푸르지오)","관리기관명":"경기도 하남시청","위도":"37.56391274","경도":"127.1837676"},
            {"금연구역명":"보림어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 덕풍북로99번길 53","관리기관명":"경기도 하남시청","위도":"37.55552486","경도":"127.1989857"},
            {"금연구역명":"봄이랑어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변대로 135 1908동 105호","관리기관명":"경기도 하남시청","위도":"37.5628161","경도":"127.1848932"},
            {"금연구역명":"부영프뢰벨어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 대청로 119 102동 103호(창우동, 부영아파트)","관리기관명":"경기도 하남시청","위도":"37.53984591","경도":"127.2268493"},
            {"금연구역명":"사랑가득어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변한강로 110 905동 101호","관리기관명":"경기도 하남시청","위도":"37.57587321","경도":"127.1869673"},
            {"금연구역명":"사랑몬테소리어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 이성로 8-13","관리기관명":"경기도 하남시청","위도":"37.53263351","경도":"127.1966782"},
            {"금연구역명":"사랑숲어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변동로 20 3101동 102호","관리기관명":"경기도 하남시청","위도":"37.55779258","경도":"127.1975386"},
            {"금연구역명":"사랑어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변서로 127 미사강변도시18블럭, 관리동어린이집","관리기관명":"경기도 하남시청","위도":"37.56203744","경도":"127.1835831"},
            {"금연구역명":"사랑해어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 위례대로6길 77 7505동 102호","관리기관명":"경기도 하남시청","위도":"37.48564228","경도":"127.1591226"},
            {"금연구역명":"사임당어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 대청로59번길 15 한국아파트 내 관리동1층 사임당어린이집 (신장동)","관리기관명":"경기도 하남시청","위도":"37.54197881","경도":"127.2177744"},
            {"금연구역명":"산곡어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 신장로56번길 37 (신장동)","관리기관명":"경기도 하남시청","위도":"37.53623464","경도":"127.2129855"},
            {"금연구역명":"산내들어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 동남로424번길 80 (감일동)","관리기관명":"경기도 하남시청","위도":"37.51088625","경도":"127.1457805"},
            {"금연구역명":"새노래어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 하남유니온로 30 , 106동 101호(신장동, 하남유시티대명루첸아파트)","관리기관명":"경기도 하남시청","위도":"37.54567301","경도":"127.2129647"},
            {"금연구역명":"새순어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 신장로76번길 40","관리기관명":"경기도 하남시청","위도":"37.53640167","경도":"127.2112531"},
            {"금연구역명":"서희키즈어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변대로 240 8단지 807동 104호","관리기관명":"경기도 하남시청","위도":"37.57043","경도":"127.1839439"},
            {"금연구역명":"성심어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 신평로168번길 12-21","관리기관명":"경기도 하남시청","위도":"37.54677965","경도":"127.2126281"},
            {"금연구역명":"세림어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 산곡동로32번길 31-7 (하산곡동)","관리기관명":"경기도 하남시청","위도":"37.5070755","경도":"127.2321169"},
            {"금연구역명":"솔샘어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변서로 127 미사강변센텀팰리스 1806동 102호","관리기관명":"경기도 하남시청","위도":"37.56082632","경도":"127.182354"},
            {"금연구역명":"솔파크어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 하남대로887번길 25-1 하남한솔솔파크 관리동 (덕풍동)","관리기관명":"경기도 하남시청","위도":"37.54389517","경도":"127.20167"},
            {"금연구역명":"숲속에어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 초이로99번길 49-14","관리기관명":"경기도 하남시청","위도":"37.54154498","경도":"127.168739"},
            {"금연구역명":"스타필드어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 더우개로 49","관리기관명":"경기도 하남시청","위도":"37.54281497","경도":"127.2206805"},
            {"금연구역명":"스펀지어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 신장로189번길 6 스펀지어린이집 (덕풍동)","관리기관명":"경기도 하남시청","위도":"37.54212247","경도":"127.1992886"},
            {"금연구역명":"시립감일꿈꾸는어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 감일순환로 170","관리기관명":"경기도 하남시청","위도":"37.50937025","경도":"127.1583558"},
            {"금연구역명":"시립감일리틀포레어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 감일순환로 135 관리동어린이집","관리기관명":"경기도 하남시청","위도":"37.51279125","경도":"127.1622353"},
            {"금연구역명":"시립감일마크베르어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 감일중앙로 80","관리기관명":"경기도 하남시청","위도":"37.51060648","경도":"127.1554505"},
            {"금연구역명":"시립감일별하어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 감일순환로 95-2","관리기관명":"경기도 하남시청","위도":"37.51190715","경도":"127.1636244"},
            {"금연구역명":"시립감일어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 감일순환로 35 관리동어린이집","관리기관명":"경기도 하남시청","위도":"37.50815403","경도":"127.1607627"},
            {"금연구역명":"시립감일한별어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 감일백제로 35 관리동어린이집","관리기관명":"경기도 하남시청","위도":"37.49870399","경도":"127.1625929"},
            {"금연구역명":"시립강변어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 미사강변서로 167 미사강변17블럭, 시립강변어린이집","관리기관명":"경기도 하남시청","위도":"37.56544682","경도":"127.1810775"},
            {"금연구역명":"시립꿈마루어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 감일백제로 120","관리기관명":"경기도 하남시청","위도":"37.50675902","경도":"127.1607303"},
            {"금연구역명":"시립꿈이든어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 하남유니온로 10","관리기관명":"경기도 하남시청","위도":"37.54532454","경도":"127.2110084"},
            {"금연구역명":"시립나룰어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 덕풍서로 45 꽃뫼마을 아파트 205동 1층 (덕풍동)","관리기관명":"경기도 하남시청","위도":"37.55167443","경도":"127.2018881"},
            {"금연구역명":"시립늘봄어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 세미로1길 30-1 관리동 어린이집","관리기관명":"경기도 하남시청","위도":"37.54191186","경도":"127.1944899"},
            {"금연구역명":"시립다솔어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 위례중앙로 215-2 시립다솔어린이집","관리기관명":"경기도 하남시청","위도":"37.47480373","경도":"127.1515265"},
            {"금연구역명":"시립단꿈어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 신우실로 15","관리기관명":"경기도 하남시청","위도":"37.5117027","경도":"127.1571904"},
            {"금연구역명":"시립단샘어린이집","금연구역구분":"어린이집","소재지도로명주소":"경기도 하남시 감일순환로 190","관리기관명":"경기도 하남시청","위도":"37.50772376","경도":"127.1569936"}
        ];

        let map = null;
        let markers = []; // 모든 마커를 담을 배열
        let infowindow = null;
        let currentSelectedCard = null;

        /**
         * 페이지 로드 시 검색 결과를 렌더링하고 지도를 초기화합니다.
         */
        window.onload = function() {
            // 하남시의 대략적인 중심 좌표
            const defaultCenter = { lat: 37.545, lng: 127.205 };
            
            // 지도 초기화
            initMap(defaultCenter.lat, defaultCenter.lng);
            
            // 모든 데이터에 대한 마커를 지도에 표시
            displayAllMarkers(originalData);

            // 리스트 렌더링
            renderResults(originalData);
        };

        /**
         * 검색 입력 필드에 이벤트 리스너를 추가하여 실시간으로 검색을 수행합니다.
         */
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            
            // 데이터 필터링
            const filteredData = originalData.filter(item => 
                (item["금연구역명"] && item["금연구역명"].toLowerCase().includes(query)) ||
                (item["소재지도로명주소"] && item["소재지도로명주소"].toLowerCase().includes(query))
            );
            
            renderResults(filteredData);
        });

        /**
         * 카카오 지도를 초기화하는 함수
         * @param {string} lat - 지도의 중심 위도
         * @param {string} lng - 지도의 중심 경도
         */
        function initMap(lat, lng) {
            const mapContainer = document.getElementById('map');
            const mapOption = {
                center: new kakao.maps.LatLng(lat, lng),
                level: 5 // 지도의 확대 레벨
            };
            map = new kakao.maps.Map(mapContainer, mapOption);
            infowindow = new kakao.maps.InfoWindow({zIndex:1});
        }
        
        /**
         * 모든 데이터에 대한 마커를 지도에 표시하는 함수
         * @param {Array<Object>} data - 마커를 표시할 데이터 배열
         */
        function displayAllMarkers(data) {
            // 기존 마커가 있다면 모두 제거
            markers.forEach(marker => marker.setMap(null));
            markers = []; // 마커 배열 초기화

            data.forEach(item => {
                const markerPosition = new kakao.maps.LatLng(item["위도"], item["경도"]);
                
                const newMarker = new kakao.maps.Marker({
                    map: map,
                    position: markerPosition
                });

                markers.push(newMarker); // 생성된 마커를 배열에 추가

                // 마커에 클릭 이벤트 추가
                kakao.maps.event.addListener(newMarker, 'click', function() {
                    // 클릭 시 인포윈도우 표시
                    infowindow.setContent('<div class="p-2 text-sm font-semibold">' + item["금연구역명"] + '</div>');
                    infowindow.open(map, newMarker);
                });
            });
        }

        /**
         * 검색 결과를 화면에 렌더링하는 함수
         * @param {Array<Object>} data - 표시할 데이터 배열
         */
        function renderResults(data) {
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.innerHTML = ''; // 기존 결과 초기화

            if (data.length === 0) {
                resultsContainer.innerHTML = '<p class="text-center text-gray-500">검색 결과가 없습니다.</p>';
                return;
            }

            data.forEach(item => {
                const resultCard = document.createElement('div');
                resultCard.className = 'bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200 cursor-pointer transition-colors hover:bg-gray-100';
                resultCard.innerHTML = `
                    <h3 class="text-xl font-semibold text-gray-900">${item["금연구역명"]}</h3>
                    <p class="text-gray-600"><strong>주소:</strong> ${item["소재지도로명주소"]}</p>
                    <p class="text-gray-600"><strong>위도:</strong> ${item["위도"]}, <strong>경도:</strong> ${item["경도"]}</p>
                `;
                
                // 클릭 이벤트 리스너 추가
                resultCard.addEventListener('click', () => {
                    // 이전에 선택된 카드 스타일 초기화
                    if (currentSelectedCard) {
                        currentSelectedCard.classList.remove('selected-card');
                    }
                    // 현재 카드에 선택된 스타일 적용
                    resultCard.classList.add('selected-card');
                    currentSelectedCard = resultCard;

                    // 지도를 클릭한 항목의 위치로 이동
                    const moveLatLon = new kakao.maps.LatLng(item["위도"], item["경도"]);
                    map.panTo(moveLatLon);

                    // 해당 위치의 마커를 찾아 인포윈도우 열기
                    const targetMarker = markers.find(marker => 
                        marker.getPosition().getLat() == item["위도"] && marker.getPosition().getLng() == item["경도"]
                    );
                    if (targetMarker) {
                         infowindow.setContent('<div class="p-2 text-sm font-semibold">' + item["금연구역명"] + '</div>');
                         infowindow.open(map, targetMarker);
                    }
                });

                resultsContainer.appendChild(resultCard);
            });
        }
    </script>
</body>
</html>
